{% extends "index.html" %}
{% load static %}

{% block main_contents %}

<div class="container my-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h1 class="mb-0" style="color: #274C77; font-weight: 600;">Log Reports</h1>
    
        <div class="d-flex flex-column align-items-end" style="margin-top: 20px;">
            <h5 id="transactionDate" class="text-muted small mb-0" style="color: #161616 !important; font-size: 1rem;">
                <i class="bi bi-calendar"></i> <span>Date of Log:</span>
            </h5>
        </div>
    </div>

    <!-- Log Table Section -->
    <div class="mt-4">
        <h3>Transaction & Restock History</h3>
        <div class="card mb-4" style="border: none; border-radius: 8px;">
            <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #274C77; color: white; border-radius: 8px 8px 0 0;">
                <h5 class="card-title mb-0">Log Entries</h5>
                <div class="d-flex">
                    <select id="logTypeFilter" class="form-select w-auto me-2">
                        <option value="all" selected>All Types</option>
                        <option value="Transaction">Transaction</option>
                        <option value="Restock">Restock</option>
                    </select>
                    <select id="logFilter" class="form-select w-auto me-2">
                        <option value="day">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                        <option value="all" selected>All</option>
                    </select>
                    <input type="date" id="dateFilter" class="form-control w-auto">
                </div>
            </div>
        <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
            
            <div class="table-container">
            <table class="table table-hover" id="logTable">
                <thead class="table-light" style="position: sticky; top: 0; background: white; z-index: 2;">
                    <tr>
                        <th scope="col">Type</th>
                        <th scope="col">Brand</th>
                        <th scope="col">Model</th>
                        <th scope="col">Color</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Price</th>
                        <th scope="col">Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">HNJ</th>
                        <td>Ewan</td>
                        <td>Black</td>
                        <td>10</td>
                        <td>Php 999</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        </th>
                        <th scope="row">EVO</td>
                        <td>GT PRO</td>
                        <td>Black</td>
                        <td>10</td>
                        <td>Php 999</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <th scope="row">EVO</th>
                        <td>GT PRO</td>
                        <td>Black</td>
                        <td>10</td>
                        <td>Php 999</td>
                        <td>2025-01-01</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>RADAR</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-03</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>FURY</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-02-03</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-01-06</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>REBOOT 2</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-02-06</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>FURY</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-02-09</td>
                    </tr>
                    <tr>
                        <td>Restock</td>
                        <th scope="row">EVO</th>
                        <td>GT PRO</td>
                        <td>Black</td>
                        <td>10</td>
                        <td>Php 999</td>
                        <td>2025-02-09</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>FUEL</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-03-18</td>
                    </tr>
                    <tr>
                        <td>Transaction</td>
                        <th scope="row">SPYDER</th>
                        <td>Ewan</td>
                        <td>Red</td>
                        <td>10</td>
                        <td>Php 4,000</td>
                        <td>2025-03-18</td>
                    </tr>
                </tbody>                
            </table>
        </div>
    </div>
</div>
</div>
</div>

<style>
    body {
        background: linear-gradient(to right, #d9dde4, #7196b3);
    }

    #logTable {
        margin: 0;
        padding: 0;
        width: 100%;
        border-collapse: collapse;
    }

    .card-body {
        max-height: 400px;
        overflow-y: auto;
    }
</style>

<script>
    function updateTransactionDate() {
        let now = new Date();
        let formattedDate = new Intl.DateTimeFormat('en-PH', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            timeZone: 'Asia/Manila'
        }).format(now);
        document.querySelector("#transactionDate span").innerText = formattedDate;
    }

    function filterLogs() {
        let typeFilter = document.getElementById("logTypeFilter").value;
        let filter = document.getElementById("logFilter").value;
        let dateFilter = document.getElementById("dateFilter").value;
        let rows = document.querySelectorAll("#logTable tbody tr");
        let now = new Date();

        rows.forEach(row => {
            let logType = row.cells[0].innerText;
            let dateText = row.cells[6].innerText;
            let logDate = new Date(dateText);
            let showRow = false;

            if (typeFilter === "all" || logType === typeFilter) {
                if (filter === "all") showRow = true;
                else if (filter === "day" && logDate.toDateString() === now.toDateString()) showRow = true;
                else if (filter === "week") {
                    let startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                    let endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(endOfWeek.getDate() + 6);
                    showRow = logDate >= startOfWeek && logDate <= endOfWeek;
                }
                else if (filter === "month" && logDate.getMonth() === now.getMonth() && logDate.getFullYear() === now.getFullYear()) showRow = true;
                else if (filter === "year" && logDate.getFullYear() === now.getFullYear()) showRow = true;
            }
            
            if (dateFilter && logDate.toISOString().split('T')[0] !== dateFilter) {
                showRow = false;
            }

            row.style.display = showRow ? "" : "none";
        });
    }

    function updateSummary() {
        let rows = document.querySelectorAll("#logTable tbody tr");
        let transactionCount = 0;
        let restockCount = 0;
        
        rows.forEach(row => {
            let logType = row.cells[0].innerText;
            if (logType === "Transaction") transactionCount++;
            if (logType === "Restock") restockCount++;
        });

        document.getElementById("totalTransactions").innerText = transactionCount;
        document.getElementById("totalRestocks").innerText = restockCount;
    }

    document.addEventListener("DOMContentLoaded", function() {
        updateTransactionDate();
        document.getElementById("logTypeFilter").addEventListener("change", filterLogs);
        document.getElementById("logFilter").addEventListener("change", filterLogs);
        document.getElementById("dateFilter").addEventListener("input", filterLogs);
    });
</script>

{% endblock %}
